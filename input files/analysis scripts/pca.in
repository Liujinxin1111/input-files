# Step one. Generate average structure.
# RMS-Fit to first frame to remove global translation/rotation.
parm ../com.top 
trajin ../m102.crd 1 10000 1
#trajin ../md22.crd
#trajin ../md23.crd
rms first !@H=
average crdset AVG
run

# Step two. RMS-Fit to average structure. Calculate covariance matrix.
# Save the fit coordinates.
rms ref AVG !@H=
matrix covar name MyMatrix @CA  out lig3.dat
#matrix covar name MyMatrix @C1' out lig3.dat
createcrd CRD1
run

# Step three. Diagonalize matrix.
runanalysis diagmatrix MyMatrix out MyMatrix3.dat vecs 500 name MyEvecs

# Step four. Project saved fit coordinates along eigenvectors 1 and 2
#crdaction CRD1 projection CPU modes MyEvecs !@H= out project.dat beg 1 end 2
crdaction CRD1 projection evecs MyEvecs @CA out project3.dat beg 1 end 3

#hist CPU:1 min -50 max 50 step 5 out cpu-gpu-hist.agr norm name CPU-1
#hist CPU:2 min -50 max 50 step 5 out cpu-gpu-hist.agr norm name CPU-2
#hist CPU:3 bins 100 out cpu-gpu-hist.agr norm name CPU-3

